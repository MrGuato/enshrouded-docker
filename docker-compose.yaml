version: "3.8"

services:
  enshrouded:
    build: .
    container_name: enshrouded-server
    restart: unless-stopped

    ports:
      - "15637:15637/udp"
      - "27015:27015/udp"

    environment:
      UPDATE_ON_START: "1"
      SERVER_NAME: "My Enshrouded Server"
      SERVER_SLOTS: "16"
      SERVER_PASSWORD: ""     # empty = no password
      GAME_PORT: "15637"
      QUERY_PORT: "27015"
      DISPLAY: ":99"          # optional; your entrypoint can also auto-pick if you implemented that

    volumes:
      # Persist config + saves/logs
      - ./enshrouded-config:/home/steam/config
      # Persist the actual server install so it doesn't re-download every time
      - ./enshrouded-server:/home/steam/server
      # Optional: persist Wine prefix (reduces first-run overhead)
      - ./enshrouded-wine:/home/steam/.wine

    healthcheck:
      test: ["CMD-SHELL", "pgrep -f enshrouded_server.exe >/dev/null 2>&1 || exit 1"]
      interval: 60s
      timeout: 10s
      start_period: 180s
      retries: 3
